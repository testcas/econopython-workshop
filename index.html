                    // Handle comma-separated print statements for level 3
                    if (currentLevel === 3 && (code.includes('print(\'Analysis for:\', country)') || code.includes('print(\'Analysis for: \', country)') || code.includes('print("Analysis for:", country)') || code.includes('print("Analysis for: ", country)'))) {
                        matches.push('Analysis for: United Kingdom');
                    }                // Check for common misconceptions in variable printing
                if (currentLevel === 2 && code.includes('print(\'gdp_growth\')')) {
                    misconceptions.push({
                        type: 'variable_vs_string',
                        message: "You're printing the word 'gdp_growth' instead of the variable's value.",
                        suggestion: "Remove quotes to print the variable: print(gdp_growth) not print('gdp_growth'). Variables don't need quotes, strings do."
                    });
                    trackError('variable_vs_string');
                }
                
                if (currentLevel === 2 && code.includes('print("gdp_growth")')) {
                    misconceptions.push({
                        type: 'variable_vs_string',
                        message: "You're printing the word 'gdp_growth' instead of the variable's value.",
                        suggestion: "Remove quotes to print the variable: print(gdp_growth) not print(\"gdp_growth\"). Variables don't need quotes, strings do."
                    });
                    trackError('variable_vs_string');
                }<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EconoPython - Python Workshop</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone@7.23.6/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .line-clamp-2 {
            overflow: hidden;
            display: -webkit-box;
            -webkit-box-orient: vertical;
            -webkit-line-clamp: 2;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect } = React;
        
        // Simple icon components
        const PlayIcon = () => React.createElement('svg', { className: "w-4 h-4", fill: "currentColor", viewBox: "0 0 16 16" }, React.createElement('path', { d: "M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zM5 4l6 4-6 4V4z" }));
        const RotateCcwIcon = () => React.createElement('svg', { className: "w-4 h-4", fill: "currentColor", viewBox: "0 0 16 16" }, React.createElement('path', { d: "M1 4a.5.5 0 0 1 .5-.5h.5a.5.5 0 0 1 0 1h-.5A.5.5 0 0 1 1 4zm12 0a.5.5 0 0 1 .5-.5h.5a.5.5 0 0 1 0 1h-.5A.5.5 0 0 1 13 4zm-7.5 2.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1H6a.5.5 0 0 1-.5-.5z" }));
        const LightbulbIcon = () => React.createElement('svg', { className: "w-5 h-5", fill: "currentColor", viewBox: "0 0 16 16" }, React.createElement('path', { d: "M6 15a.5.5 0 0 0 .5-.5V12h3v2.5a.5.5 0 0 0 1 0V12h.5a.5.5 0 0 0 0-1H13V8a5 5 0 0 0-10 0v3h.5a.5.5 0 0 0 0 1H4v2.5a.5.5 0 0 0 .5.5h1zM5 8a4 4 0 1 1 8 0v3H5V8z" }));
        const CheckCircleIcon = () => React.createElement('svg', { className: "w-5 h-5", fill: "currentColor", viewBox: "0 0 16 16" }, React.createElement('path', { d: "M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z" }));
        const LockIcon = () => React.createElement('svg', { className: "w-5 h-5", fill: "currentColor", viewBox: "0 0 16 16" }, React.createElement('path', { d: "M4 4a4 4 0 0 1 8 0v1h-1V4a3 3 0 0 0-6 0v1H4V4zm2 3V6h4v1h1v6H5V7h1z" }));
        const TrophyIcon = () => React.createElement('svg', { className: "w-5 h-5", fill: "currentColor", viewBox: "0 0 16 16" }, React.createElement('path', { d: "M8 1a.5.5 0 0 1 .5.5V3h3a.5.5 0 0 1 0 1h-.5v2.5a3.5 3.5 0 0 1-7 0V4H3.5a.5.5 0 0 1 0-1h3V1.5A.5.5 0 0 1 8 1z" }));
        const FlameIcon = () => React.createElement('svg', { className: "w-4 h-4", fill: "currentColor", viewBox: "0 0 16 16" }, React.createElement('path', { d: "M8 16c3.314 0 6-2 6-5.5 0-1.5-.5-4-2.5-6C10.438 3.489 8.5 2.5 8 0c-.5 2.5-2.438 3.489-3.5 4.5C2.5 6.5 2 9 2 10.5 2 14 4.686 16 8 16z" }));
        const TrendingUpIcon = () => React.createElement('svg', { className: "w-8 h-8", fill: "currentColor", viewBox: "0 0 16 16" }, React.createElement('path', { d: "M15.854 4.854a.5.5 0 0 0-.708-.708L11 8.293 8.854 6.146a.5.5 0 0 0-.708 0L4.5 9.793l-.646-.647a.5.5 0 0 0-.708.708l1 1a.5.5 0 0 0 .708 0L8.5 7.207l2.146 2.147a.5.5 0 0 0 .708 0l4.5-4.5z" }));

        const EconoPython = () => {
            // Level definitions
            const levels = [
                {
                    id: 1,
                    title: "Getting Started with Python",
                    description: "Begin your coding journey with basic Python syntax.",
                    task: "Print 'Hello, World!' to get started.",
                    starterCode: "# Your first program\n",
                    expectedOutput: "Hello, World!",
                    hint: "Use the print() function with text inside quotes.",
                    solution: "print('Hello, World!')"
                },
                {
                    id: 2,
                    title: "Storing Values",
                    description: "Learn to store data using variables.",
                    task: "Create a variable 'gdp_growth' with value 2.5 and print it.",
                    starterCode: "# Store economic indicators as variables\n",
                    expectedOutput: "2.5",
                    hint: "First create a variable, then use print() to display it.",
                    solution: "gdp_growth = 2.5\nprint(gdp_growth)"
                },
                {
                    id: 3,
                    title: "Data Types",
                    description: "Work with different types of data: strings for country names, numbers for indicators.",
                    task: "Create a variable 'country' with value 'United Kingdom' and print 'Analysis for: [country]'",
                    starterCode: "# Economic data often includes country names\n",
                    expectedOutput: "Analysis for: United Kingdom",
                    hint: "Use f-strings to combine text with variables. The format is f'text {variable} more text'.",
                    solution: "country = 'United Kingdom'\nprint(f'Analysis for: {country}')"
                },
                {
                    id: 4,
                    title: "Basic Calculations",
                    description: "Perform basic calculations - GDP growth, inflation adjustments, etc.",
                    task: "Calculate real GDP: If nominal GDP is 1000 and price level is 1.05, calculate real GDP (1000/1.05).",
                    starterCode: "# Real GDP = Nominal GDP / Price Level\nnominal_gdp = 1000\nprice_level = 1.05\n",
                    expectedOutput: "952.3809523809524",
                    hint: "Create a new variable for the result of dividing nominal_gdp by price_level, then print it.",
                    solution: "nominal_gdp = 1000\nprice_level = 1.05\nreal_gdp = nominal_gdp / price_level\nprint(real_gdp)"
                },
                {
                    id: 5,
                    title: "Conditional Logic",
                    description: "Use conditional logic for economic analysis - policy thresholds, recession indicators.",
                    task: "Check if unemployment rate (8.5) is above 8%. If yes, print 'High unemployment detected'",
                    starterCode: "# Policy analysis often uses thresholds\nunemployment_rate = 8.5\n",
                    expectedOutput: "High unemployment detected",
                    hint: "Use an if statement to compare the unemployment rate to 8.0. Remember to indent the print statement.",
                    solution: "unemployment_rate = 8.5\nif unemployment_rate > 8.0:\n    print('High unemployment detected')"
                },
                {
                    id: 6,
                    title: "Loops",
                    description: "Use while loops for iterative forecasting models.",
                    task: "Simulate a convergence process: start with value 10, multiply by 0.9 each iteration until value < 5.",
                    starterCode: "# Economic models often use iterative processes\nvalue = 10\n",
                    expectedOutput: "10\n9.0\n8.1\n7.29\n6.561\n5.9049\n5.31441",
                    hint: "Use a while loop that continues as long as value is >= 5. Inside the loop, print the value, then update it.",
                    solution: "value = 10\nwhile value >= 5:\n    print(value)\n    value = value * 0.9"
                },
                {
                    id: 7,
                    title: "Dictionaries",
                    description: "Store structured data using dictionaries.",
                    task: "Create economic indicators dict: country='UK', gdp=2800, unemployment=4.2. Print the GDP value.",
                    starterCode: "# Store economic indicators as key-value pairs\n",
                    expectedOutput: "2800",
                    hint: "Create a dictionary with curly braces {}. Access values using square brackets with the key name.",
                    solution: "indicators = {'country': 'UK', 'gdp': 2800, 'unemployment': 4.2}\nprint(indicators['gdp'])"
                },
                {
                    id: 8,
                    title: "Using Lists",
                    description: "Create unemployment data [5.2, 5.0, 4.8, 4.5, 4.3], then calculate and print each rate multiplied by 100 (to convert to basis points).",
                    task: "Create unemployment data [5.2, 5.0, 4.8, 4.5, 4.3], then calculate and print each rate multiplied by 100 (to convert to basis points).",
                    starterCode: "# Convert unemployment rates to basis points for analysis\n",
                    expectedOutput: "520.0\n500.0\n480.0\n450.0\n430.0",
                    hint: "Create a list with square brackets [], then use a for loop to go through each item and print it * 100.",
                    solution: "unemployment_rates = [5.2, 5.0, 4.8, 4.5, 4.3]\nfor rate in unemployment_rates:\n    print(rate * 100)"
                }
            ];

            // Challenge mode levels
            const challengeLevels = [
                {
                    id: 9,
                    title: "Data Analysis Challenge",
                    description: "Analyze economic data using multiple Python concepts together.",
                    task: "Calculate the average GDP growth rate from the list [2.1, 3.4, 1.8, 2.9, 3.2] and determine if it's above 2.5%.",
                    starterCode: "# Challenge: Combine lists, calculations, and conditionals\ngdp_growth_rates = [2.1, 3.4, 1.8, 2.9, 3.2]\n",
                    expectedOutput: "2.68\nAbove target",
                    hint: "Calculate the sum of all values, divide by the count, then use an if statement to check if it's above 2.5.",
                    solution: "gdp_growth_rates = [2.1, 3.4, 1.8, 2.9, 3.2]\naverage = sum(gdp_growth_rates) / len(gdp_growth_rates)\nprint(average)\nif average > 2.5:\n    print('Above target')\nelse:\n    print('Below target')"
                },
                {
                    id: 10,
                    title: "Policy Analysis Challenge",
                    description: "Create a comprehensive policy analysis tool.",
                    task: "Create a policy_analysis dictionary with country='Netherlands', unemployment=3.8, inflation=2.1. Check if both are within targets (unemployment < 5%, inflation < 3%) and print appropriate messages.",
                    starterCode: "# Challenge: Complex data structures and multiple conditions\n",
                    expectedOutput: "Unemployment: Within target\nInflation: Within target\nOverall: Policy targets met",
                    hint: "Create the dictionary, then use separate if statements for each indicator, and a final check for both conditions.",
                    solution: "policy_analysis = {'country': 'Netherlands', 'unemployment': 3.8, 'inflation': 2.1}\nif policy_analysis['unemployment'] < 5.0:\n    print('Unemployment: Within target')\nelse:\n    print('Unemployment: Above target')\nif policy_analysis['inflation'] < 3.0:\n    print('Inflation: Within target')\nelse:\n    print('Inflation: Above target')\nif policy_analysis['unemployment'] < 5.0 and policy_analysis['inflation'] < 3.0:\n    print('Overall: Policy targets met')\nelse:\n    print('Overall: Policy targets not met')"
                },
                {
                    id: 11,
                    title: "Economic Comparison Challenge",
                    description: "Compare economic performance across multiple countries.",
                    task: "Create a list of countries ['Germany', 'France', 'Italy'] and GDP values [4200, 2900, 2100]. Find and print the country with the highest GDP.",
                    starterCode: "# Challenge: Working with parallel lists and finding maximum values\n",
                    expectedOutput: "Germany",
                    hint: "Use the max() function to find the highest GDP, then use the index() method to find its position in the list.",
                    solution: "countries = ['Germany', 'France', 'Italy']\ngdp_values = [4200, 2900, 2100]\nmax_gdp = max(gdp_values)\nmax_index = gdp_values.index(max_gdp)\nprint(countries[max_index])"
                }
            ];

            // State management
            const [currentLevel, setCurrentLevel] = useState(1);
            const [userCode, setUserCode] = useState(levels[0].starterCode);
            const [completedLevels, setCompletedLevels] = useState(new Set());
            const [showHint, setShowHint] = useState(false);
            const [feedback, setFeedback] = useState(null);
            const [streak, setStreak] = useState(0);
            const [showLevelSelector, setShowLevelSelector] = useState(false);
            const [challengeMode, setChallengeMode] = useState(false);
            const [attemptCount, setAttemptCount] = useState(0);
            const [totalAttempts, setTotalAttempts] = useState(0);
            const [commonErrors, setCommonErrors] = useState({});
            const [showMetrics, setShowMetrics] = useState(false);

            // Combined levels for display
            const allLevels = challengeMode ? [...levels, ...challengeLevels] : levels;
            const currentLevelData = allLevels.find(l => l.id === currentLevel);
            const totalLevels = allLevels.length;

            // Update user code when level changes
            useEffect(() => {
                const level = allLevels.find(l => l.id === currentLevel);
                if (level) {
                    setUserCode(level.starterCode);
                    setShowHint(false);
                    setFeedback(null);
                    setAttemptCount(0);
                }
            }, [currentLevel, challengeMode]);

            // Track metrics
            const trackError = (errorType) => {
                setCommonErrors(prev => ({
                    ...prev,
                    [errorType]: (prev[errorType] || 0) + 1
                }));
            };

            const trackSuccess = (levelId, attempts) => {
                const metrics = {
                    level: levelId,
                    attempts: attempts,
                    timestamp: new Date().toISOString(),
                    challengeMode: challengeMode
                };
                console.log('SUCCESS METRICS:', metrics);
            };

            // Enhanced misconception detection
            const detectMisconceptions = (code) => {
                const misconceptions = [];
                
                if (code.includes('print ') && !code.includes('print(')) {
                    misconceptions.push({
                        type: 'print_syntax',
                        message: "Remember: In Python, functions need parentheses. Use print() not print.",
                        suggestion: "Change 'print variable' to 'print(variable)'"
                    });
                    trackError('print_syntax');
                }
                
                if (code.includes('if ') && code.includes('=') && !code.includes('==') && !code.includes('!=') && !code.includes('>=') && !code.includes('<=')) {
                    misconceptions.push({
                        type: 'assignment_in_condition',
                        message: "In conditions, use == to compare, not = (which assigns values).",
                        suggestion: "Change 'if variable = value' to 'if variable == value'"
                    });
                    trackError('assignment_in_condition');
                }
                
                if ((code.includes('if ') || code.includes('while ') || code.includes('for ')) && code.includes('\n')) {
                    const lines = code.split('\n');
                    for (let i = 0; i < lines.length - 1; i++) {
                        if (lines[i].includes(':') && lines[i + 1] && !lines[i + 1].startsWith('    ') && !lines[i + 1].startsWith('\t') && lines[i + 1].trim()) {
                            misconceptions.push({
                                type: 'indentation',
                                message: "Python requires indentation after colons (:). The next line should be indented.",
                                suggestion: "Add 4 spaces or press Tab before the line after ':'"
                            });
                            trackError('indentation');
                            break;
                        }
                    }
                }
                
                if (currentLevel === 2 && code.includes('gdp') && !code.includes('gdp_growth')) {
                    misconceptions.push({
                        type: 'wrong_variable',
                        message: "Make sure to use the exact variable name requested: 'gdp_growth'",
                        suggestion: "Change your variable name to 'gdp_growth'"
                    });
                    trackError('wrong_variable');
                }
                
                if (code.includes('Hello, World') && !code.includes("'Hello, World!'") && !code.includes('"Hello, World!"')) {
                    misconceptions.push({
                        type: 'missing_quotes',
                        message: "Text (strings) must be wrapped in quotes in Python.",
                        suggestion: "Put quotes around text: 'Hello, World!' or \"Hello, World!\""
                    });
                    trackError('missing_quotes');
                }
                
                if (code.includes('[') && code.includes(']') && code.includes('gdp') && !code.includes("'gdp'") && !code.includes('"gdp"')) {
                    misconceptions.push({
                        type: 'dict_key_quotes',
                        message: "Dictionary keys must be in quotes when accessing them.",
                        suggestion: "Use indicators['gdp'] with quotes around the key"
                    });
                    trackError('dict_key_quotes');
                }
                
                return misconceptions;
            };

            // Syntax error detection function
            const checkSyntaxErrors = (code) => {
                const errors = [];
                const lines = code.split('\n');
                
                for (let i = 0; i < lines.length; i++) {
                    const line = lines[i].trim();
                    if (!line || line.startsWith('#')) continue;
                    
                    const singleQuotes = (line.match(/'/g) || []).length;
                    const doubleQuotes = (line.match(/"/g) || []).length;
                    if (singleQuotes % 2 !== 0) {
                        errors.push(`Missing closing quote (') on line ${i + 1}`);
                    }
                    if (doubleQuotes % 2 !== 0) {
                        errors.push(`Missing closing quote (") on line ${i + 1}`);
                    }
                    
                    if (line.includes('print') && !line.includes('print(')) {
                        errors.push(`Missing opening parenthesis ( after 'print' on line ${i + 1}`);
                    }
                    if (line.includes('print(') && !line.includes(')')) {
                        errors.push(`Missing closing parenthesis ) for 'print' on line ${i + 1}`);
                    }
                    
                    if ((line.includes('if ') || line.includes('while ') || line.includes('for ')) && !line.includes(':')) {
                        errors.push(`Missing colon (:) at end of line ${i + 1}`);
                    }
                    
                    if (line.includes('gdp_growth') && line.includes('2.5') && !line.includes('=')) {
                        errors.push(`Missing equals sign (=) for variable assignment on line ${i + 1}`);
                    }
                    
                    if (line.includes('unemployment_rates') && line.includes('5.2') && !line.includes('[')) {
                        errors.push(`Missing opening bracket ([) for list on line ${i + 1}`);
                    }
                    if (line.includes('[') && line.includes('5.2') && !line.includes(']')) {
                        errors.push(`Missing closing bracket (]) for list on line ${i + 1}`);
                    }
                    
                    if (line.includes('indicators') && line.includes('UK') && !line.includes('{')) {
                        errors.push(`Missing opening brace ({) for dictionary on line ${i + 1}`);
                    }
                    if (line.includes('{') && line.includes('UK') && !line.includes('}')) {
                        errors.push(`Missing closing brace (}) for dictionary on line ${i + 1}`);
                    }
                }
                
                return errors;
            };

            // Enhanced code execution simulation
            const executeCode = (code) => {
                try {
                    const misconceptions = detectMisconceptions(code);
                    if (misconceptions.length > 0) {
                        return `Misconception: ${misconceptions[0].message}\n${misconceptions[0].suggestion}`;
                    }

                    const syntaxErrors = checkSyntaxErrors(code);
                    if (syntaxErrors.length > 0) {
                        trackError('syntax_error');
                        return `Syntax Error: ${syntaxErrors[0]}`;
                    }

                    const printRegex = /print\((.*?)\)/g;
                    const matches = [];
                    let match;
                    
                    while ((match = printRegex.exec(code)) !== null) {
                        let value = match[1].trim();
                        
                        if (value.startsWith("'") && value.endsWith("'")) {
                            matches.push(value.slice(1, -1));
                        } else if (value.startsWith('"') && value.endsWith('"')) {
                            matches.push(value.slice(1, -1));
                        } else if (value.match(/^\d+\.?\d*$/)) {
                            matches.push(value);
                        } else if (value.includes('f\'') || value.includes('f"')) {
                            if (code.includes('country = \'United Kingdom\'') || code.includes('country = "United Kingdom"')) {
                                matches.push(value.replace(/f['"]Analysis for: \{country\}['"]/, 'Analysis for: United Kingdom'));
                            }
                        } else if (value.includes('Analysis for:') && value.includes('country')) {
                            // Handle both comma-separated and f-string formats
                            if (code.includes('country = \'United Kingdom\'') || code.includes('country = "United Kingdom"')) {
                                matches.push('Analysis for: United Kingdom');
                            }
                        } else if (value.includes('*') || value.includes('/')) {
                            try {
                                const result = eval(value);
                                matches.push(result.toString());
                            } catch {
                                matches.push(value);
                            }
                        } else {
                            // Handle variable references and other cases
                            if (value === 'gdp_growth' && code.includes('gdp_growth = 2.5')) matches.push('2.5');
                            else if (value === 'real_gdp' && code.includes('nominal_gdp = 1000') && code.includes('price_level = 1.05')) matches.push('952.3809523809524');
                            else if (value === 'nominal_gdp/price_level' && code.includes('nominal_gdp = 1000') && code.includes('price_level = 1.05')) matches.push('952.3809523809524');
                            else if ((value === 'indicators[\'gdp\']' || value === 'indicators["gdp"]') && code.includes('indicators')) matches.push('2800');
                            else if (value.includes('unemployment_rate') && code.includes('High unemployment detected')) matches.push('High unemployment detected');
                            else {
                                // For any other cases, try to evaluate safely
                                try {
                                    const result = eval(value);
                                    matches.push(result.toString());
                                } catch {
                                    matches.push(value);
                                }
                            }
                        }
                    }

                    // Handle loops and special cases
                    if (code.includes('while value >= 5')) {
                        matches.push('10', '9.0', '8.1', '7.29', '6.561', '5.9049', '5.31441');
                    }
                    if (code.includes('for rate in unemployment_rates') && code.includes('rate * 100')) {
                        matches.push('520.0', '500.0', '480.0', '450.0', '430.0');
                    }
                    
                    // Challenge mode outputs
                    if (code.includes('average') && code.includes('sum(gdp_growth_rates)')) {
                        matches.push('2.68');
                        if (code.includes('Above target')) matches.push('Above target');
                    }
                    if (code.includes('Unemployment: Within target')) matches.push('Unemployment: Within target');
                    if (code.includes('Inflation: Within target')) matches.push('Inflation: Within target');
                    if (code.includes('Overall: Policy targets met')) matches.push('Overall: Policy targets met');
                    if (code.includes('Germany') && code.includes('max_gdp')) matches.push('Germany');

                    return matches.join('\n');
                } catch (error) {
                    trackError('execution_error');
                    return "Error: " + error.message;
                }
            };

            const handleSubmit = () => {
                const level = allLevels.find(l => l.id === currentLevel);
                setAttemptCount(prev => prev + 1);
                setTotalAttempts(prev => prev + 1);
                
                const output = executeCode(userCode);
                const isCorrect = output.trim() === level.expectedOutput.trim();

                if (isCorrect) {
                    setCompletedLevels(prev => new Set([...prev, currentLevel]));
                    setStreak(prev => prev + 1);
                    trackSuccess(currentLevel, attemptCount + 1);
                    
                    // Check for comma-separated print in level 3 and suggest f-string
                    let successMessage = 'Correct!';
                    let suggestion = null;
                    
                    if (currentLevel === 3 && (userCode.includes('print(\'Analysis for:\', country)') || userCode.includes('print(\'Analysis for: \', country)') || userCode.includes('print("Analysis for:", country)') || userCode.includes('print("Analysis for: ", country)'))) {
                        suggestion = "Good job! For a more elegant solution, try using f-strings: print(f'Analysis for: {country}')";
                    }
                    
                    setFeedback({
                        type: 'success',
                        message: successMessage,
                        output: output,
                        attempts: attemptCount + 1,
                        suggestion: suggestion
                    });
                } else {
                    setStreak(0);
                    setFeedback({
                        type: 'error',
                        message: 'Let\'s refine your code:',
                        output: output,
                        expected: level.expectedOutput,
                        explanation: level.hint,
                        attempts: attemptCount + 1
                    });
                }
            };

            const handleReset = () => {
                const level = allLevels.find(l => l.id === currentLevel);
                setUserCode(level.starterCode);
                setFeedback(null);
                setShowHint(false);
                setAttemptCount(0);
            };

            const handleLevelChange = (levelId) => {
                const maxUnlockedLevel = Math.max(1, Math.max(...Array.from(completedLevels)) + 1);
                if (levelId <= maxUnlockedLevel) {
                    setCurrentLevel(levelId);
                    setShowLevelSelector(false);
                }
            };

            const toggleChallengeMode = () => {
                setChallengeMode(!challengeMode);
                setCurrentLevel(1);
                setShowLevelSelector(false);
            };

            const progressPercentage = (completedLevels.size / totalLevels) * 100;

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50">
                    <header className="bg-white shadow-lg border-b-2 border-indigo-600">
                        <div className="max-w-7xl mx-auto px-4 py-4">
                            <div className="flex items-center justify-between">
                                <div className="flex items-center space-x-4">
                                    <div className="flex items-center space-x-2">
                                        <TrendingUpIcon />
                                        <h1 className="text-3xl font-bold text-indigo-600">EconoPython</h1>
                                    </div>
                                    <div className="flex items-center space-x-2 text-gray-600">
                                        <TrophyIcon />
                                        <span className="font-medium">{completedLevels.size}/{totalLevels} Levels</span>
                                        {challengeMode && <span className="text-purple-600 text-sm">üèÜ Challenge</span>}
                                    </div>
                                </div>
                                
                                <div className="flex items-center space-x-4">
                                    <div className="hidden sm:block text-sm text-gray-600 bg-gray-100 px-3 py-1 rounded-full">
                                        MSc Economics & Policy ‚Ä¢ King's College London
                                    </div>
                                    
                                    <button
                                        onClick={() => setShowMetrics(!showMetrics)}
                                        className="text-sm text-gray-600 bg-blue-100 px-3 py-1 rounded-full hover:bg-blue-200 transition-colors"
                                    >
                                        üìä Metrics
                                    </button>
                                    
                                    <button
                                        onClick={toggleChallengeMode}
                                        className={`text-sm px-3 py-1 rounded-full transition-colors ${
                                            challengeMode 
                                                ? 'bg-purple-100 text-purple-700 hover:bg-purple-200' 
                                                : 'bg-gray-100 text-gray-600 hover:bg-gray-200'
                                        }`}
                                    >
                                        {challengeMode ? 'üèÜ Challenge Mode' : 'üéØ Normal Mode'}
                                    </button>
                                    
                                    <div className="flex items-center space-x-2 bg-orange-100 px-3 py-1 rounded-full">
                                        <FlameIcon />
                                        <span className="font-bold text-orange-700">{streak}</span>
                                        <span className="text-orange-600 text-sm">streak</span>
                                    </div>
                                    
                                    <button
                                        onClick={() => setShowLevelSelector(!showLevelSelector)}
                                        className="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition-colors font-medium"
                                    >
                                        Level {currentLevel}
                                    </button>
                                </div>
                            </div>
                            
                            <div className="mt-4">
                                <div className="flex justify-between text-sm text-gray-600 mb-1">
                                    <span>Python Skills Progress</span>
                                    <span>{Math.round(progressPercentage)}%</span>
                                </div>
                                <div className="w-full bg-gray-200 rounded-full h-2">
                                    <div 
                                        className="bg-indigo-600 h-2 rounded-full transition-all duration-500"
                                        style={{ width: `${progressPercentage}%` }}
                                    ></div>
                                </div>
                            </div>
                        </div>
                    </header>

                    {showMetrics && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
                            <div className="bg-white rounded-xl max-w-2xl w-full max-h-[80vh] overflow-y-auto">
                                <div className="p-6">
                                    <div className="flex justify-between items-center mb-6">
                                        <h2 className="text-2xl font-bold text-gray-800">Success Metrics</h2>
                                        <button
                                            onClick={() => setShowMetrics(false)}
                                            className="text-gray-500 hover:text-gray-700 text-xl"
                                        >
                                            √ó
                                        </button>
                                    </div>
                                    
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                        <div className="bg-blue-50 p-4 rounded-lg">
                                            <h3 className="font-semibold text-blue-800 mb-2">Progress Stats</h3>
                                            <div className="space-y-2 text-sm">
                                                <div>Completed Levels: {completedLevels.size}/{totalLevels}</div>
                                                <div>Current Streak: {streak}</div>
                                                <div>Total Attempts: {totalAttempts}</div>
                                                <div>Mode: {challengeMode ? 'Challenge' : 'Normal'}</div>
                                            </div>
                                        </div>
                                        
                                        <div className="bg-red-50 p-4 rounded-lg">
                                            <h3 className="font-semibold text-red-800 mb-2">Common Errors</h3>
                                            <div className="space-y-2 text-sm">
                                                {Object.entries(commonErrors).length > 0 ? (
                                                    Object.entries(commonErrors).map(([error, count]) => (
                                                        <div key={error}>
                                                            {error.replace('_', ' ')}: {count}
                                                        </div>
                                                    ))
                                                ) : (
                                                    <div className="text-gray-600">No errors yet - great job!</div>
                                                )}
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div className="mt-6 p-4 bg-gray-50 rounded-lg">
                                        <h3 className="font-semibold text-gray-800 mb-2">For Instructors</h3>
                                        <p className="text-sm text-gray-600 mb-2">
                                            Success metrics are logged to browser console. Check browser developer tools (F12) for detailed analytics.
                                        </p>
                                        <p className="text-xs text-gray-500">
                                            Look for "SUCCESS METRICS:" entries to track student progress and identify areas where students struggle.
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {showLevelSelector && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
                            <div className="bg-white rounded-xl max-w-5xl w-full max-h-[80vh] overflow-y-auto">
                                <div className="p-6">
                                    <div className="flex justify-between items-center mb-6">
                                        <h2 className="text-2xl font-bold text-gray-800">
                                            Select {challengeMode ? 'Challenge' : 'Python'} Level
                                        </h2>
                                        <button
                                            onClick={() => setShowLevelSelector(false)}
                                            className="text-gray-500 hover:text-gray-700 text-xl"
                                        >
                                            √ó
                                        </button>
                                    </div>
                                    
                                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                        {allLevels.map((level) => {
                                            const isCompleted = completedLevels.has(level.id);
                                            const isLocked = level.id > Math.max(1, Math.max(...Array.from(completedLevels)) + 1);
                                            const isCurrentLevel = level.id === currentLevel;
                                            const isChallenge = level.id > 8;
                                            
                                            return (
                                                <button
                                                    key={level.id}
                                                    onClick={() => !isLocked && handleLevelChange(level.id)}
                                                    disabled={isLocked}
                                                    className={`p-4 rounded-lg border-2 text-left transition-all ${
                                                        isCurrentLevel
                                                            ? 'border-indigo-500 bg-indigo-50'
                                                            : isCompleted
                                                            ? 'border-green-500 bg-green-50 hover:bg-green-100'
                                                            : isLocked
                                                            ? 'border-gray-300 bg-gray-100 cursor-not-allowed opacity-50'
                                                            : isChallenge
                                                            ? 'border-purple-300 bg-purple-50 hover:border-purple-400 hover:bg-purple-100'
                                                            : 'border-gray-300 bg-white hover:border-indigo-300 hover:bg-indigo-50'
                                                    }`}
                                                >
                                                    <div className="flex items-center justify-between mb-2">
                                                        <span className="font-bold text-sm text-gray-600">
                                                            Level {level.id} {isChallenge && 'üèÜ'}
                                                        </span>
                                                        {isCompleted ? (
                                                            <CheckCircleIcon />
                                                        ) : isLocked ? (
                                                            <LockIcon />
                                                        ) : null}
                                                    </div>
                                                    <h3 className="font-semibold text-gray-800 mb-1">{level.title}</h3>
                                                    <p className="text-xs text-gray-600 line-clamp-2">{level.description}</p>
                                                </button>
                                            );
                                        })}
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    <main className="max-w-7xl mx-auto px-4 py-8">
                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                            <div className="bg-white rounded-xl shadow-lg p-6">
                                <div className="mb-6">
                                    <div className="flex items-center justify-between mb-4">
                                        <h2 className="text-2xl font-bold text-gray-800">
                                            Level {currentLevel}: {currentLevelData.title}
                                        </h2>
                                        {completedLevels.has(currentLevel) && (
                                            <CheckCircleIcon />
                                        )}
                                    </div>
                                    
                                    <p className="text-gray-600 mb-4">{currentLevelData.description}</p>
                                    
                                    <div className="bg-indigo-50 border-l-4 border-indigo-500 p-4 rounded-r-lg">
                                        <h3 className="font-semibold text-indigo-800 mb-2">Task:</h3>
                                        <p className="text-indigo-700">{currentLevelData.task}</p>
                                    </div>
                                </div>

                                <div className="mb-6">
                                    <button
                                        onClick={() => setShowHint(!showHint)}
                                        className="flex items-center space-x-2 text-yellow-600 hover:text-yellow-700 transition-colors"
                                    >
                                        <LightbulbIcon />
                                        <span className="font-medium">
                                            {showHint ? 'Hide Hint' : 'Show Hint'}
                                        </span>
                                    </button>
                                    
                                    {showHint && (
                                        <div className="mt-3 bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded-r-lg">
                                            <p className="text-yellow-800">{currentLevelData.hint}</p>
                                        </div>
                                    )}
                                </div>

                                {feedback && (
                                    <div className={`p-4 rounded-lg mb-6 ${
                                        feedback.type === 'success' 
                                            ? 'bg-green-50 border border-green-200' 
                                            : 'bg-red-50 border border-red-200'
                                    }`}>
                                        <p className={`font-medium mb-2 ${
                                            feedback.type === 'success' 
                                                ? 'text-green-800' 
                                                : 'text-red-800'
                                        }`}>
                                            {feedback.message}
                                        </p>
                                        
                                        {feedback.attempts && (
                                            <div className="mb-2">
                                                <p className="text-sm text-gray-600">
                                                    Attempt #{feedback.attempts} {feedback.type === 'success' ? '‚úÖ' : '‚ùå'}
                                                </p>
                                            </div>
                                        )}
                                        
                                        {feedback.output && (
                                            <div className="mb-2">
                                                <p className="text-sm text-gray-600 mb-1">Your output:</p>
                                                <pre className="bg-gray-100 p-2 rounded text-sm font-mono">{feedback.output}</pre>
                                            </div>
                                        )}
                                        
                                        {feedback.expected && (
                                            <div className="mb-2">
                                                <p className="text-sm text-gray-600 mb-1">Expected output:</p>
                                                <pre className="bg-gray-100 p-2 rounded text-sm font-mono">{feedback.expected}</pre>
                                            </div>
                                        )}
                                        
                                        {feedback.suggestion && (
                                            <div className="mt-3 p-3 bg-blue-50 rounded">
                                                <p className="text-sm text-blue-800"><strong>Suggestion:</strong> {feedback.suggestion}</p>
                                            </div>
                                        )}
                                        
                                        {feedback.explanation && feedback.type === 'error' && (
                                            <div className="mt-3 p-3 bg-blue-50 rounded">
                                                <p className="text-sm text-blue-800"><strong>Tip:</strong> {feedback.explanation}</p>
                                            </div>
                                        )}
                                    </div>
                                )}
                            </div>

                            <div className="bg-white rounded-xl shadow-lg overflow-hidden">
                                <div className="bg-gray-800 text-white p-4 flex items-center justify-between">
                                    <h3 className="font-semibold">üìä Python Editor</h3>
                                    <div className="flex items-center space-x-2">
                                        <button
                                            onClick={handleReset}
                                            className="flex items-center space-x-1 bg-gray-700 hover:bg-gray-600 px-3 py-1 rounded transition-colors text-sm"
                                        >
                                            <RotateCcwIcon />
                                            <span>Reset</span>
                                        </button>
                                        <button
                                            onClick={handleSubmit}
                                            className="flex items-center space-x-1 bg-green-600 hover:bg-green-500 px-3 py-1 rounded transition-colors text-sm"
                                        >
                                            <PlayIcon />
                                            <span>Run Code</span>
                                        </button>
                                    </div>
                                </div>
                                
                                <div className="p-0">
                                    <textarea
                                        value={userCode}
                                        onChange={(e) => setUserCode(e.target.value)}
                                        className="w-full h-96 p-4 font-mono text-sm bg-gray-900 text-green-400 border-0 resize-none focus:outline-none focus:ring-0"
                                        placeholder="# Write your econometric Python code here..."
                                        spellCheck={false}
                                    />
                                </div>
                            </div>
                        </div>

                        <div className="mt-8 flex justify-between items-center">
                            <button
                                onClick={() => currentLevel > 1 && handleLevelChange(currentLevel - 1)}
                                disabled={currentLevel === 1}
                                className="px-6 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                            >
                                Previous Level
                            </button>
                            
                            <div className="text-center">
                                <p className="text-gray-600">
                                    Level {currentLevel} of {totalLevels} {challengeMode && currentLevel > 8 ? 'üèÜ' : ''}
                                </p>
                            </div>
                            
                            <button
                                onClick={() => {
                                    if (completedLevels.has(currentLevel) && currentLevel < totalLevels) {
                                        handleLevelChange(currentLevel + 1);
                                    }
                                }}
                                disabled={!completedLevels.has(currentLevel) || currentLevel === totalLevels}
                                className="px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                            >
                                Next Level
                            </button>
                        </div>

                        <div className="mt-12 bg-white rounded-xl shadow-lg p-6">
                            <div className="text-center">
                                <h3 className="text-lg font-semibold text-gray-800 mb-2">
                                    Python Workshop for MSc Economics and Policy
                                </h3>
                                <p className="text-gray-600 mb-4">
                                    King's College London ‚Ä¢ Interactive Python fundamentals
                                </p>
                                <div className="flex justify-center space-x-6 text-sm text-gray-500">
                                    <div className="flex items-center space-x-1">
                                        <TrendingUpIcon />
                                        <span>Economic Analysis</span>
                                    </div>
                                    <div className="flex items-center space-x-1">
                                        <TrophyIcon />
                                        <span>Interactive Learning</span>
                                    </div>
                                    <div className="flex items-center space-x-1">
                                        <CheckCircleIcon />
                                        <span>Practical Skills</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(EconoPython));
    </script>
</body>
</html>